import{a as F,b as q,a3 as be,u as B,dW as Ce,r as M,e$ as ce,bB as de,ed as Se,bk as ue,f0 as Me,ev as K,j as e,cA as N,f1 as Le,B as Ae,D as Ie,E as Re,eB as Te,f2 as Ee,cr as R,a5 as Fe,I as L,bp as Y,f3 as te,a4 as me,T as O,l as X,ep as ge,az as ee,a$ as ke,f4 as we,aE as w,n as ve,f5 as Q,w as pe,dv as Z,o as Pe,cs as Oe,aG as Be,aH as De,aR as _,f6 as $e,ez as fe,ee as He,aZ as Ne,bG as Ue,Q as Ve,q as We,p as _e,f7 as he,cS as ze,eA as qe,f8 as Ge,eg as Qe,ak as Ze,dS as Je,P as E,bM as U,Z as V,bx as se,L as D,f9 as ne,aF as Ke,K as Ye,bU as b,$ as Xe,fa as et,cB as J,bq as tt,et as st,ey as nt,z as at,a2 as it,aI as rt,fb as lt,fc as ot,fd as ct}from"./strapi-Ce0-1BU9.js";import{S as ae}from"./SearchInput-h_pEuzo-.js";import{u as dt}from"./hooks-CiB6gjRJ.js";const ie=["json","component","media","richtext","dynamiczone","password","blocks"],ut=["createdAt","updatedAt"],mt=[...ce,"strapi_assignee"],re=({disabled:t,schema:n})=>{const{attributes:s,uid:a,options:o}=n,{formatMessage:c,locale:h}=F(),{trackUsage:g}=q(),i=be("FiltersImpl",p=>p.permissions),[{query:f}]=B(),{schemas:j}=Ce(),A=M.useMemo(()=>i.filter(p=>p.action==="admin::users.read"&&p.subject===null).length>0,[i]),y=(f?.filters?.$and??[]).reduce((p,k)=>{const[x,m]=Object.entries(k)[0];if(typeof m.id!="object")return p;const P=m.id.$eq||m.id.$ne,r=s[x],C=r?.type==="relation"&&"target"in r&&r.target==="admin::user";return P&&(C||mt.includes(x))&&!p.includes(P)&&p.push(P),p},[]),{data:S,isLoading:u}=de({filters:{id:{$in:y}}},{skip:y.length===0||!A}),{users:l=[]}=S??{},{metadata:T}=Se(a,{selectFromResult:({data:p})=>({metadata:p?.contentType.metadatas??{}})}),$=ue(h,{sensitivity:"base"}),H=M.useMemo(()=>{const[{properties:{fields:p=[]}={fields:[]}}]=i.filter(x=>x.action==="plugin::content-manager.explorer.read"&&x.subject===a);return["id","documentId",...p.filter(x=>{const m=s[x]??{};return m.type&&!ie.includes(m.type)}),...ut,...A?ce:[]].map(x=>{const m=s[x];if(ie.includes(m.type))return null;const{mainField:P="",label:r}=T[x].list;let C={name:x,label:r??"",mainField:Me(m,P,{schemas:j,components:{}}),type:m.type};return m.type==="relation"&&"target"in m&&m.target==="admin::user"&&(C={...C,input:gt,options:l.map(d=>({label:K(d),value:d.id.toString()})),operators:[{label:c({id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"}),value:"$eq"},{label:c({id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"}),value:"$ne"}],mainField:{name:"id",type:"integer"}}),m.type==="enumeration"&&(C={...C,options:m.enum.map(d=>({label:d,value:d}))}),C}).filter(Boolean).toSorted((x,m)=>$.compare(x.label,m.label))},[i,A,a,s,T,j,l,c,$]),v=p=>{p&&g("willFilterEntries")},I=p=>{const k=s[p.name];k&&g("didFilterEntries",{useRelation:k.type==="relation"})};return e.jsxs(N.Root,{disabled:t,options:H,onOpenChange:v,onChange:I,children:[e.jsx(N.Trigger,{}),e.jsx(N.Popover,{zIndex:499}),e.jsx(N.List,{})]})},gt=({name:t})=>{const[n,s]=M.useState(10),[a,o]=M.useState(""),{formatMessage:c}=F(),h=Le(a,300),{data:g,isLoading:i}=de({pageSize:n,_q:h}),f=Ae(t),j=l=>{l||s(10)},{users:A=[],pagination:y}=g??{},{pageCount:S=1,page:u=1}=y??{};return e.jsx(Ie,{value:f.value,"aria-label":c({id:"content-manager.components.Filters.usersSelect.label",defaultMessage:"Search and select a user to filter"}),onOpenChange:j,onChange:l=>f.onChange(t,l),loading:i,onLoadMore:()=>s(n+10),hasMoreItems:u<S,onInputChange:l=>{o(l.currentTarget.value)},children:A.map(l=>e.jsx(Re,{value:l.id.toString(),children:K(l)},l.id))})},z=({type:t,value:n})=>{const{formatDate:s,formatTime:a,formatNumber:o}=F();let c=n;if(t==="date"&&(c=s(Te(n),{dateStyle:"full"})),t==="datetime"&&(c=s(n,{dateStyle:"full",timeStyle:"short"})),t==="time"){const[h,g,i]=n.split(":"),f=new Date;f.setHours(h),f.setMinutes(g),f.setSeconds(i),c=a(f,{timeStyle:"short"})}return["float","decimal"].includes(t)&&(c=o(n,{maximumFractionDigits:20})),["integer","biginteger"].includes(t)&&(c=o(n,{maximumFractionDigits:0})),Ee(c)},pt=({content:t,mainField:n})=>n?e.jsx(Y,{label:t[n.name],children:e.jsx(L,{maxWidth:"25rem",textColor:"neutral800",ellipsis:!0,children:e.jsx(z,{type:n.type,value:t[n.name]})})}):null,ft=({content:t,mainField:n})=>{const{formatMessage:s}=F();return n?e.jsxs(R.Root,{children:[e.jsxs(R.Trigger,{onClick:a=>a.stopPropagation(),children:[e.jsx(Fe,{children:t.length}),s({id:"content-manager.containers.list.items",defaultMessage:"{number, plural, =0 {items} one {item} other {items}}"},{number:t.length})]}),e.jsx(R.Content,{children:t.map(a=>e.jsx(R.Item,{disabled:!0,children:e.jsx(L,{maxWidth:"50rem",ellipsis:!0,children:e.jsx(z,{type:n.type,value:a[n.name]})})},a.id))})]}):null},ht=t=>t&&t[0]==="."?t.substring(1):t,xe=({url:t,mime:n,alternativeText:s,name:a,ext:o,formats:c})=>{const h=te(t);if(n.includes("image")){const f=c?.thumbnail?.url,j=te(f)||h;return e.jsx(me.Item,{src:j,alt:s||a,fallback:s||a,preview:!0})}const g=ht(o),i=a.length>100?`${a.substring(0,100)}...`:a;return e.jsx(Y,{label:i,children:e.jsx("span",{children:e.jsx(je,{children:g})})})},je=({children:t})=>e.jsx(O,{tag:"span",position:"relative",borderRadius:"50%",width:"26px",height:"26px",borderColor:"neutral200",background:"neutral150",paddingLeft:"1px",justifyContent:"center",alignItems:"center",children:e.jsx(xt,{variant:"sigma",textColor:"neutral600",children:t})}),xt=X(L)`
  font-size: 0.9rem;
  line-height: 0.9rem;
`,jt=({content:t})=>e.jsx(me.Group,{children:t.map((n,s)=>{const a=`${n.id}${s}`;if(s===3){const o=`+${t.length-3}`;return e.jsx(je,{children:o},a)}return s>3?null:e.jsx(xe,{...n},a)})}),yt=({mainField:t,content:n})=>e.jsx(L,{maxWidth:"50rem",textColor:"neutral800",ellipsis:!0,children:ge(n,t)}),bt=({mainField:t,content:n,rowId:s,name:a})=>{const{model:o}=ee(),{formatMessage:c}=F(),{notifyStatus:h}=ke(),[g,i]=M.useState(!1),[{query:f}]=B(),j=f.plugins?.i18n?.locale,[A]=a.split("."),{data:y,isLoading:S}=we({model:o,id:s,targetField:A,params:{locale:j}},{skip:!g,refetchOnMountOrArgChange:!0}),u=Array.isArray(n)?n.length:n.count;return M.useEffect(()=>{y&&h(c({id:w("DynamicTable.relation-loaded"),defaultMessage:"Relations have been loaded"}))},[y,c,h]),e.jsxs(R.Root,{onOpenChange:l=>i(l),children:[e.jsx(R.Trigger,{onClick:l=>l.stopPropagation(),children:e.jsx(L,{style:{cursor:"pointer"},textColor:"neutral800",fontWeight:"regular",children:u>0?c({id:"content-manager.containers.list.items",defaultMessage:"{number} {number, plural, =0 {items} one {item} other {items}}"},{number:u}):"-"})}),e.jsxs(R.Content,{children:[S&&e.jsx(R.Item,{disabled:!0,children:e.jsx(ve,{small:!0,children:c({id:w("ListViewTable.relation-loading"),defaultMessage:"Relations are loading"})})}),y?.results&&e.jsxs(e.Fragment,{children:[y.results.map(l=>e.jsx(R.Item,{children:e.jsx(L,{maxWidth:"50rem",ellipsis:!0,children:ge(l,t)})},l.documentId)),y?.pagination&&y?.pagination.total>10&&e.jsx(R.Item,{"aria-disabled":!0,"aria-label":c({id:w("ListViewTable.relation-more"),defaultMessage:"This relation contains more entities than displayed"}),children:e.jsx(L,{children:"â€¦"})})]})]})]})},Ct=({content:t,mainField:n,attribute:s,rowId:a,name:o})=>{if(!St(t,n,s))return e.jsx(L,{textColor:"neutral800",paddingLeft:s.type==="relation"?"1.6rem":0,paddingRight:s.type==="relation"?"1.6rem":0,children:"-"});switch(s.type){case"media":return s.multiple?e.jsx(jt,{content:t}):e.jsx(xe,{...t});case"relation":return ye(s.relation)?e.jsx(yt,{mainField:n,content:t}):e.jsx(bt,{rowId:a,mainField:n,content:t,name:o});case"component":return s.repeatable?e.jsx(ft,{mainField:n,content:t}):e.jsx(pt,{mainField:n,content:t});case"string":return e.jsx(Y,{label:t,children:e.jsx(L,{maxWidth:"30rem",ellipsis:!0,textColor:"neutral800",children:e.jsx(z,{type:s.type,value:t})})});default:return e.jsx(L,{maxWidth:"30rem",ellipsis:!0,textColor:"neutral800",children:e.jsx(z,{type:s.type,value:t})})}},St=(t,n,s)=>{if(s.type==="component"){if(s.repeatable||!n)return t?.length>0;const a=t?.[n.name];return n.name==="id"&&![void 0,null].includes(a)?!0:!Q(a)}return s.type==="relation"?ye(s.relation)?!Q(t):Array.isArray(t)?t.length>0:t?.count>0:["integer","decimal","float","number"].includes(s.type)?typeof t=="number":s.type==="boolean"?t!==null:!Q(t)},ye=t=>["oneToOne","manyToOne","oneToOneMorph"].includes(t),le=t=>{const n=dt(c=>c.admin_app.permissions.contentManager?.collectionTypesConfigurations??[]),[{query:s}]=B(),{formatMessage:a}=F(),{allowedActions:{canConfigureView:o}}=pe(n);return e.jsxs(Z.Root,{children:[e.jsx(Z.Trigger,{children:e.jsx(Pe,{label:a({id:"components.ViewSettings.tooltip",defaultMessage:"View Settings"}),children:e.jsx(Oe,{})})}),e.jsx(Z.Content,{side:"bottom",align:"end",sideOffset:4,children:e.jsxs(O,{alignItems:"stretch",direction:"column",padding:3,gap:3,children:[o?e.jsx(Be,{size:"S",startIcon:e.jsx($e,{}),variant:"secondary",tag:De,to:{pathname:"configurations/list",search:s.plugins?_.stringify({plugins:s.plugins},{encode:!1}):""},children:a({id:"app.links.configure-view",defaultMessage:"Configure the view"})}):null,e.jsx(Mt,{...t})]})})]})},Mt=({headers:t=[],resetHeaders:n,setHeaders:s})=>{const{trackUsage:a}=q(),{formatMessage:o,locale:c}=F(),{schema:h,model:g}=ee(),{list:i}=fe(g),f=ue(c,{sensitivity:"base"}),j=h?.attributes??{},A=Object.keys(j).filter(u=>He(j[u])).map(u=>({name:u,label:i.metadatas[u]?.label??""})).sort((u,l)=>f.compare(u.label,l.label)),y=u=>{a("didChangeDisplayedFields");const l=t.includes(u)?t.filter(T=>T!==u):[...t,u];s(l)},S=()=>{n()};return e.jsxs(O,{tag:"fieldset",direction:"column",alignItems:"stretch",gap:1,borderWidth:0,maxHeight:"240px",padding:1,overflow:"auto",children:[e.jsxs(O,{justifyContent:"space-between",gap:2,children:[e.jsx(L,{tag:"legend",variant:"pi",fontWeight:"bold",children:o({id:"containers.list.displayedFields",defaultMessage:"Displayed fields"})}),e.jsx(Ne,{onClick:S,children:o({id:"app.components.Button.reset",defaultMessage:"Reset"})})]}),e.jsx(O,{direction:"column",alignItems:"stretch",children:A.map(u=>{const l=t.includes(u.name);return e.jsx(O,{wrap:"wrap",gap:2,background:l?"primary100":"transparent",hasRadius:!0,padding:2,marginBottom:1,children:e.jsx(Ue,{onCheckedChange:()=>y(u.name),checked:l,name:u.name,children:e.jsx(L,{fontSize:1,children:u.label})})},u.name)})})]})},{INJECT_COLUMN_IN_TABLE:Lt}=Je,oe=X(D.Header)`
  overflow-wrap: anywhere;
`,At=()=>{const{trackUsage:t}=q(),n=Ve(),{formatMessage:s}=F(),{toggleNotification:a}=We(),{_unstableFormatAPIError:o}=_e(w),{collectionType:c,model:h,schema:g}=ee(),{list:i}=fe(h),[f,j]=M.useState([]),A=he(i.layout);M.useEffect(()=>{ze(A,i.layout)||j(i.layout)},[i.layout,A]);const y=r=>{j(lt(r,g.attributes,i.metadatas))},[{query:S}]=B({page:"1",pageSize:i.settings.pageSize.toString(),sort:i.settings.defaultSortBy?`${i.settings.defaultSortBy}:${i.settings.defaultSortOrder}`:""}),u=M.useMemo(()=>qe(S),[S]),{data:l,error:T,isLoading:$,isFetching:H}=Ge({model:h,params:u});M.useEffect(()=>{T&&a({type:"danger",message:o(T)})},[T,o,a]);const{results:v=[],pagination:I}=l??{};M.useEffect(()=>{I&&I.pageCount>0&&I.page>I.pageCount&&n({search:_.stringify({...S,page:I.pageCount})},{replace:!0})},[I,s,S,n]);const{canCreate:p}=Qe("ListViewPage",({canCreate:r})=>({canCreate:r})),k=Ze("ListViewPage",({runHookWaterfall:r})=>r),x=M.useMemo(()=>{const C=k(Lt,{displayedHeaders:f,layout:i}).displayedHeaders.map(d=>{const G=typeof d.label=="string"?{id:`content-manager.content-types.${h}.${d.name}`,defaultMessage:d.label}:d.label;return{...d,label:s(G),name:`${d.name}${d.mainField?.name?`.${d.mainField.name}`:""}`}});return g?.options?.draftAndPublish&&C.push({attribute:{type:"custom"},name:"status",label:s({id:w("containers.list.table-headers.status"),defaultMessage:"status"}),searchable:!1,sortable:!1}),C},[f,s,i,k,g?.options?.draftAndPublish,h]);if($)return e.jsx(E.Loading,{});if(T)return e.jsx(E.Error,{});const m=g?.info.displayName?s({id:g.info.displayName,defaultMessage:g.info.displayName}):s({id:"content-manager.containers.untitled",defaultMessage:"Untitled"}),P=r=>()=>{t("willEditEntryFromList"),n({pathname:r.toString(),search:_.stringify({plugins:S.plugins})})};return!H&&v.length===0?e.jsxs(e.Fragment,{children:[e.jsx(U.contentManager.Introduction,{children:e.jsx(V,{})}),e.jsxs(E.Main,{children:[e.jsx(E.Title,{children:`${m}`}),e.jsx(oe,{primaryAction:p?e.jsx(U.contentManager.CreateNewEntry,{children:e.jsx(W,{})}):null,subtitle:s({id:w("pages.ListView.header-subtitle"),defaultMessage:"{number, plural, =0 {# entries} one {# entry} other {# entries}} found"},{number:I?.total}),title:m,navigationAction:e.jsx(se,{})}),e.jsx(D.Action,{endActions:e.jsxs(e.Fragment,{children:[e.jsx(ne,{area:"listView.actions"}),e.jsx(le,{setHeaders:y,resetHeaders:()=>j(i.layout),headers:f.map(r=>r.name)})]}),startActions:e.jsxs(e.Fragment,{children:[i.settings.searchable&&e.jsx(ae,{label:s({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:m}),placeholder:s({id:"global.search",defaultMessage:"Search"}),trackedEvent:"didSearch"}),i.settings.filterable&&g?e.jsx(re,{schema:g}):null]})}),e.jsx(D.Content,{children:e.jsx(V,{background:"neutral0",shadow:"filterShadow",hasRadius:!0,children:e.jsx(Ke,{action:p&&e.jsx(V,{children:e.jsx(W,{variant:"secondary"})}),content:s({id:"app.components.EmptyStateLayout.content-document",defaultMessage:"No content found"}),hasRadius:!0,icon:e.jsx(Ye,{width:"16rem"})})})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(U.contentManager.Introduction,{children:e.jsx(V,{})}),e.jsxs(E.Main,{children:[e.jsx(E.Title,{children:`${m}`}),e.jsx(oe,{primaryAction:p?e.jsx(U.contentManager.CreateNewEntry,{children:e.jsx(W,{})}):null,subtitle:s({id:w("pages.ListView.header-subtitle"),defaultMessage:"{number, plural, =0 {# entries} one {# entry} other {# entries}} found"},{number:I?.total}),title:m,navigationAction:e.jsx(se,{})}),e.jsx(D.Action,{endActions:e.jsxs(e.Fragment,{children:[e.jsx(ne,{area:"listView.actions"}),e.jsx(le,{setHeaders:y,resetHeaders:()=>j(i.layout),headers:f.map(r=>r.name)})]}),startActions:e.jsxs(e.Fragment,{children:[i.settings.searchable&&e.jsx(ae,{disabled:v.length===0,label:s({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:m}),placeholder:s({id:"global.search",defaultMessage:"Search"}),trackedEvent:"didSearch"}),i.settings.filterable&&g?e.jsx(re,{disabled:v.length===0,schema:g}):null]})}),e.jsx(D.Content,{children:e.jsxs(O,{gap:4,direction:"column",alignItems:"stretch",children:[e.jsxs(b.Root,{rows:v,headers:x,isLoading:H,children:[e.jsx(Rt,{}),e.jsxs(b.Content,{children:[e.jsxs(b.Head,{children:[e.jsx(b.HeaderCheckboxCell,{}),x.map(r=>e.jsx(b.HeaderCell,{...r},r.name))]}),e.jsx(b.Loading,{}),e.jsx(b.Empty,{action:p?e.jsx(W,{variant:"secondary"}):null}),e.jsx(b.Body,{children:v.map(r=>e.jsxs(b.Row,{cursor:"pointer",onClick:P(r.documentId),children:[e.jsx(b.CheckboxCell,{id:r.id}),x.map(({cellFormatter:C,...d})=>{if(d.name==="status"){const{status:G}=r;return e.jsx(b.Cell,{children:e.jsx(Xe,{status:G,maxWidth:"min-content"})},d.name)}return["createdBy","updatedBy"].includes(d.name.split(".")[0])?e.jsx(b.Cell,{children:e.jsx(L,{textColor:"neutral800",children:r[d.name.split(".")[0]]?K(r[d.name.split(".")[0]]):"-"})},d.name):typeof C=="function"?e.jsx(b.Cell,{children:C(r,d,{collectionType:c,model:h})},d.name):e.jsx(b.Cell,{children:e.jsx(Ct,{content:r[d.name.split(".")[0]],rowId:r.documentId,...d})},d.name)}),e.jsx(It,{onClick:C=>C.stopPropagation(),children:e.jsx(et,{document:r})})]},r.id))})]})]}),e.jsxs(J.Root,{...I,onPageSizeChange:()=>t("willChangeNumberOfEntriesPerPage"),children:[e.jsx(J.PageSize,{}),e.jsx(J.Links,{})]})]})})]})]})},It=X(b.Cell)`
  display: flex;
  justify-content: flex-end;
`,Rt=()=>{const t=ot("TableActionsBar",o=>o.selectRow),[{query:n}]=B(),s=n?.plugins?.i18n?.locale,a=he(s);return M.useEffect(()=>{a!==s&&t([])},[t,a,s]),e.jsx(b.ActionBar,{children:e.jsx(ct,{})})},W=({variant:t})=>{const{formatMessage:n}=F(),{trackUsage:s}=q(),[{query:a}]=B();return e.jsx(at,{variant:t,tag:it,onClick:()=>{s("willCreateEntry",{status:"draft"})},startIcon:e.jsx(rt,{}),style:{textDecoration:"none"},to:{pathname:"create",search:_.stringify({plugins:a.plugins})},minWidth:"max-content",fullWidth:!0,children:n({id:w("HeaderLayout.button.label-add-entry"),defaultMessage:"Create new entry"})})},kt=()=>{const{slug:t=""}=tt(),{permissions:n=[],isLoading:s,error:a}=pe(st.map(o=>({action:o,subject:t})));return s?e.jsx(E.Loading,{}):a||!t?e.jsx(E.Error,{}):e.jsx(E.Protect,{permissions:n,children:({permissions:o})=>e.jsx(nt,{permissions:o,children:e.jsx(At,{})})})};export{At as ListViewPage,kt as ProtectedListViewPage};
